# Focus Mode 功能说明

## 概述

Focus Mode 是一个专门为提升工作效率和注意力而设计的模式，包含两个主要视图：

1. **Kanban 看板** - 拖拽式任务管理
2. **Work Mode** - 专注工作模式

## 功能特性

### 1. Kanban 看板
- 直接复用现有的看板功能
- 支持拖拽操作更新任务状态
- 实时显示任务进度
- 支持筛选和搜索

### 2. Work Mode 专注工作模式

#### 左侧任务资源管理器
- **文件夹式结构**：每个分类显示为一个文件夹
- **任务列表**：每个文件夹下显示该分类的所有任务
- **展开/折叠**：支持文件夹的展开和折叠操作
- **任务计数**：显示每个分类下的任务数量
- **未分类任务**：单独显示未分类的任务
- **模式切换**：支持"当前"和"Backlog"两种视图模式
  - **当前模式**：显示进行中、待办和过期的任务
  - **Backlog模式**：显示暂停（on_hold）的任务

#### 右侧内容区域
- **任务信息显示**：显示任务标题、描述和分类信息
- **任务信息管理**：
  - 显示/隐藏任务基本信息
  - 支持编辑任务的所有字段（标题、描述、状态、优先级、进度、截止日期、预估时长、负责人、标签）
  - 实时编辑和保存功能
- **Markdown 编辑器**：支持常用的 Markdown 格式
  - 粗体、斜体
  - 标题（H1、H2、H3）
  - 列表（有序、无序、任务列表）
  - 引用、代码、链接、图片
  - 分割线
- **实时预览**：支持编辑和预览模式切换
- **保存功能**：分别保存笔记和元数据
- **状态栏**：显示字符数和行数统计

## 使用方法

### 访问 Focus Mode
1. 在导航栏中点击 "Focus" 标签
2. 页面会显示 Focus Mode 的主界面

### 切换视图
1. 在页面顶部的切换按钮中选择：
   - "Kanban 看板" - 查看拖拽式任务管理
   - "Work Mode" - 进入专注工作模式

### 使用 Work Mode
1. **切换模式**：在左侧选择"当前"或"Backlog"视图模式
2. **选择任务**：在左侧任务资源管理器中点击任意任务
3. **查看任务信息**：点击"显示任务信息"按钮查看任务基本信息
4. **编辑任务信息**：点击"编辑"按钮修改任务的所有字段
5. **编辑笔记**：在右侧编辑器中编写任务相关的笔记
6. **使用工具栏**：点击工具栏按钮插入 Markdown 格式
7. **预览内容**：点击"预览"按钮查看渲染效果
8. **保存内容**：分别保存任务信息和笔记

## 技术实现

### 组件结构
```
focus/
├── page.tsx              # Focus 主页面
└── work-mode/
    ├── page.tsx          # Work Mode 页面
    └── MarkdownEditor.tsx # Markdown 编辑器组件
```

### 已知问题和解决方案

#### 笔记保存错误
**问题**: 保存笔记时出现400错误，提示"Invalid enum value"错误
**原因**: API期望`category`字段是枚举值（如'work', 'personal'等），但传递了分类名称
**解决方案**: 在保存笔记时只传递`notes`字段，避免传递错误的`category`字段

```typescript
// 修复前（错误）
await updateTask(selectedTask.id, { 
  content: { 
    ...selectedTask.content,  // 包含错误的category字段
    notes 
  } 
})

// 修复后（正确）
await updateTask(selectedTask.id, { 
  content: { 
    notes  // 只更新notes字段
  } 
})
```

### 主要特性
- **响应式设计**：适配不同屏幕尺寸
- **类型安全**：完整的 TypeScript 支持
- **状态管理**：使用 React hooks 管理组件状态
- **样式系统**：基于 Tailwind CSS 的现代化 UI
- **Markdown 支持**：自定义的 Markdown 解析和渲染

### 依赖项
- `@tailwindcss/typography` - Markdown 样式支持
- `lucide-react` - 图标库
- Next.js 15 - React 框架

## 未来改进

1. **自动保存**：实现笔记的自动保存功能
2. **快捷键支持**：添加键盘快捷键操作
3. **更多 Markdown 功能**：支持表格、代码块等
4. **主题切换**：支持深色模式
5. **协作功能**：支持多人协作编辑
6. **版本历史**：笔记的版本控制功能
