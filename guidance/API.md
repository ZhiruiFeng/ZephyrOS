# ZephyrOS API Documentation

Complete API reference for the ZMemory backend service.

## Base URL

- **Development**: `http://localhost:3001`
- **Production**: `https://your-domain.vercel.app`

## Authentication

Currently, ZephyrOS operates without authentication for development purposes. In production, consider implementing:

- Supabase Auth for user authentication
- API key-based authentication
- JWT tokens for session management

## Data Models

### Memory

The core data structure for all content in ZephyrOS.

```typescript
interface Memory {
  id: string;                    // UUID generated by database
  type: string;                  // Content type: 'task', 'note', 'bookmark', etc.
  content: any;                  // Flexible JSON content
  tags?: string[];               // Array of tag strings
  metadata?: Record<string, any>; // Additional metadata
  created_at: string;            // ISO 8601 timestamp
  updated_at: string;            // ISO 8601 timestamp
}
```

### Task Content Example

```typescript
interface TaskContent {
  title: string;
  description?: string;
  status: 'pending' | 'in_progress' | 'completed';
  priority: 'low' | 'medium' | 'high';
  due_date?: string;  // ISO 8601 date string
}

// Example Memory with Task content
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "type": "task",
  "content": {
    "title": "Complete API documentation",
    "description": "Write comprehensive API docs for ZMemory",
    "status": "in_progress",
    "priority": "high",
    "due_date": "2024-08-15T00:00:00Z"
  },
  "tags": ["documentation", "api"],
  "metadata": {
    "created_by": "user",
    "project": "zephyros"
  },
  "created_at": "2024-08-01T10:00:00Z",
  "updated_at": "2024-08-01T15:30:00Z"
}
```

## API Endpoints

### Health Check

#### GET /api/health

Check the health status of the API service.

**Response:**
```json
{
  "status": "healthy",
  "timestamp": "2024-08-01T10:00:00Z",
  "service": "zmemory-api",
  "version": "1.0.0"
}
```

**Status Codes:**
- `200` - Service is healthy
- `503` - Service is unhealthy

---

### Memory Management

#### GET /api/memories

Retrieve a list of memories with optional filtering.

**Query Parameters:**
- `type` (optional) - Filter by memory type (e.g., "task", "note")
- `limit` (optional) - Maximum number of results (default: 50, max: 100)
- `offset` (optional) - Number of records to skip (default: 0)

**Example Requests:**
```bash
# Get all memories
GET /api/memories

# Get only tasks
GET /api/memories?type=task

# Get first 10 tasks
GET /api/memories?type=task&limit=10

# Get next 10 tasks (pagination)
GET /api/memories?type=task&limit=10&offset=10
```

**Response:**
```json
[
  {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "type": "task",
    "content": {
      "title": "Example task",
      "status": "pending",
      "priority": "medium"
    },
    "tags": ["example"],
    "created_at": "2024-08-01T10:00:00Z",
    "updated_at": "2024-08-01T10:00:00Z"
  }
]
```

**Status Codes:**
- `200` - Success
- `400` - Invalid query parameters
- `500` - Server error

---

#### POST /api/memories

Create a new memory.

**Request Body:**
```json
{
  "type": "task",
  "content": {
    "title": "New task",
    "description": "Task description",
    "status": "pending",
    "priority": "medium"
  },
  "tags": ["work", "important"],
  "metadata": {
    "project": "zephyros"
  }
}
```

**Response:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440001",
  "type": "task",
  "content": {
    "title": "New task",
    "description": "Task description",
    "status": "pending",
    "priority": "medium"
  },
  "tags": ["work", "important"],
  "metadata": {
    "project": "zephyros"
  },
  "created_at": "2024-08-01T10:00:00Z",
  "updated_at": "2024-08-01T10:00:00Z"
}
```

**Status Codes:**
- `201` - Created successfully
- `400` - Invalid request data
- `500` - Server error

---

#### GET /api/memories/[id]

Retrieve a specific memory by ID.

**Path Parameters:**
- `id` - UUID of the memory

**Example Request:**
```bash
GET /api/memories/550e8400-e29b-41d4-a716-446655440000
```

**Response:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "type": "task",
  "content": {
    "title": "Example task",
    "status": "pending",
    "priority": "medium"
  },
  "tags": ["example"],
  "created_at": "2024-08-01T10:00:00Z",
  "updated_at": "2024-08-01T10:00:00Z"
}
```

**Status Codes:**
- `200` - Success
- `404` - Memory not found
- `500` - Server error

---

#### PUT /api/memories/[id]

Update an existing memory.

**Path Parameters:**
- `id` - UUID of the memory

**Request Body (partial update):**
```json
{
  "content": {
    "status": "completed"
  },
  "tags": ["work", "important", "done"]
}
```

**Response:**
```json
{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "type": "task",
  "content": {
    "title": "Example task",
    "status": "completed",
    "priority": "medium"
  },
  "tags": ["work", "important", "done"],
  "created_at": "2024-08-01T10:00:00Z",
  "updated_at": "2024-08-01T15:30:00Z"
}
```

**Status Codes:**
- `200` - Updated successfully
- `400` - Invalid request data
- `404` - Memory not found
- `500` - Server error

---

#### DELETE /api/memories/[id]

Delete a memory.

**Path Parameters:**
- `id` - UUID of the memory

**Response:**
```json
{
  "message": "Memory deleted successfully"
}
```

**Status Codes:**
- `200` - Deleted successfully
- `404` - Memory not found
- `500` - Server error

---

## Error Responses

All error responses follow this format:

```json
{
  "error": "Error description",
  "details": "Additional error details (optional)"
}
```

### Common Error Codes

- `400 Bad Request` - Invalid request data or parameters
- `404 Not Found` - Resource not found
- `422 Unprocessable Entity` - Validation errors
- `500 Internal Server Error` - Server-side errors
- `503 Service Unavailable` - Service is temporarily unavailable

### Validation Errors

When validation fails, the response includes detailed error information:

```json
{
  "error": "Invalid data format",
  "details": [
    {
      "field": "content.title",
      "message": "Title is required"
    },
    {
      "field": "type",
      "message": "Type must be a string"
    }
  ]
}
```

## Rate Limiting

- **Development**: No rate limiting
- **Production**: 100 requests per minute per IP address

When rate limit is exceeded:

```json
{
  "error": "Rate limit exceeded",
  "details": "Too many requests. Please try again later."
}
```

**Headers:**
- `X-RateLimit-Limit` - Maximum requests per window
- `X-RateLimit-Remaining` - Remaining requests in current window
- `X-RateLimit-Reset` - Time when the rate limit resets (Unix timestamp)

## Content Types

### Task

Used for task management and to-do items.

```typescript
interface TaskContent {
  title: string;
  description?: string;
  status: 'pending' | 'in_progress' | 'completed';
  priority: 'low' | 'medium' | 'high';
  due_date?: string;  // ISO 8601 date
}
```

### Note

For knowledge management and note-taking.

```typescript
interface NoteContent {
  title: string;
  content: string;
  format: 'markdown' | 'text' | 'html';
  folder?: string;
}
```

### Bookmark

For saving and organizing web links.

```typescript
interface BookmarkContent {
  title: string;
  url: string;
  description?: string;
  favicon?: string;
  folder?: string;
}
```

### Custom Types

You can create custom memory types by defining your own content structure:

```typescript
interface CustomContent {
  [key: string]: any;
}
```

## Search (Future Feature)

When search functionality is implemented:

#### GET /api/memories/search

**Query Parameters:**
- `q` - Search query string
- `type` (optional) - Filter by memory type
- `limit` (optional) - Maximum results (default: 50)

**Example:**
```bash
GET /api/memories/search?q=important&type=task&limit=10
```

## Webhooks (Future Feature)

When webhook support is added:

#### POST /api/webhooks

Configure webhooks for memory events:
- `memory.created`
- `memory.updated` 
- `memory.deleted`

## SDKs and Libraries

### JavaScript/TypeScript Client

```typescript
import { ApiClient } from '@zephyros/api-client';

const client = new ApiClient({
  baseUrl: 'http://localhost:3001',
  // apiKey: 'your-api-key' // When authentication is added
});

// Create a task
const task = await client.createMemory({
  type: 'task',
  content: {
    title: 'New task',
    status: 'pending',
    priority: 'high'
  },
  tags: ['urgent']
});

// Get all tasks
const tasks = await client.getMemories({ type: 'task' });

// Update task
await client.updateMemory(task.id, {
  content: { status: 'completed' }
});
```

### cURL Examples

```bash
# Health check
curl http://localhost:3001/api/health

# Get all memories
curl http://localhost:3001/api/memories

# Create a new task
curl -X POST http://localhost:3001/api/memories \
  -H "Content-Type: application/json" \
  -d '{
    "type": "task",
    "content": {
      "title": "Call client",
      "priority": "high",
      "status": "pending"
    },
    "tags": ["work", "client"]
  }'

# Update a task
curl -X PUT http://localhost:3001/api/memories/[id] \
  -H "Content-Type: application/json" \
  -d '{
    "content": {
      "status": "completed"
    }
  }'

# Delete a memory
curl -X DELETE http://localhost:3001/api/memories/[id]
```

## Development

### Mock Data Mode

When Supabase is not configured, the API returns mock data:

```json
{
  "id": "1",
  "type": "task",
  "content": {
    "title": "Sample Task",
    "description": "This is a sample task",
    "status": "pending",
    "priority": "medium"
  },
  "tags": ["zflow", "task"],
  "created_at": "2024-08-01T10:00:00Z",
  "updated_at": "2024-08-01T10:00:00Z"
}
```

### Environment Variables

Required environment variables:

```env
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key

# Optional Configuration
NODE_ENV=development|production
```

### CORS Configuration

The API includes CORS headers for cross-origin requests:

```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, POST, PUT, DELETE, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
```

## Production Considerations

### Security

1. **Environment Variables**: Store sensitive data in environment variables
2. **Input Validation**: All inputs are validated using Zod schemas
3. **Rate Limiting**: Implement rate limiting in production
4. **Authentication**: Add user authentication for production use

### Performance

1. **Database Indexes**: Ensure proper indexing on frequently queried fields
2. **Caching**: Implement response caching for better performance
3. **Pagination**: Always use pagination for large datasets
4. **Connection Pooling**: Configure Supabase connection pooling

### Monitoring

1. **Health Checks**: Regular health check endpoint monitoring
2. **Error Tracking**: Implement error tracking (e.g., Sentry)
3. **Metrics**: Track API usage and performance metrics
4. **Logging**: Comprehensive request/response logging

---

**API Version**: 1.0.0  
**Last Updated**: August 2024